# docker-compose.yml de référence pour Dokploy
# Ce fichier montre la configuration des services pour Dokploy
# Dans Dokploy, vous créerez 3 services séparés : frontend, backend, et db (géré par Dokploy)

services:
  # Service Frontend
  frontend:
    image: ${DOCKER_USERNAME}/skyjo-frontend:latest
    restart: always
    ports:
      - "80:80"
    depends_on:
      - backend
    # Pas de variables d'environnement nécessaires pour le frontend
    # Les variables VITE_* sont injectées au build time

  # Service Backend
  backend:
    image: ${DOCKER_USERNAME}/skyjo-backend:latest
    restart: always
    ports:
      - "3000:3000"
    environment:
      # Variables à configurer dans Dokploy (Environment)
      - DB_HOST=${DB_HOST}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_NAME=${DB_NAME}
      - DB_PORT=${DB_PORT}
      - JWT_SECRET=${JWT_SECRET}
      - APP_URL=${APP_URL}
      - EMAIL_HOST=${EMAIL_HOST}
      - EMAIL_PORT=${EMAIL_PORT}
      - EMAIL_USER=${EMAIL_USER}
      - EMAIL_PASS=${EMAIL_PASS}
      - EMAIL_FROM=${EMAIL_FROM}
      - PORT=3000
      - NODE_ENV=production
    depends_on:
      - db

  # Service Database (géré directement dans Dokploy)
  # Cette section est pour référence seulement
  # Créez un service MySQL dans Dokploy avec les mêmes paramètres
  db:
    image: mysql:latest
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=${DB_NAME}
      - MYSQL_USER=${DB_USER}
      - MYSQL_PASSWORD=${DB_PASSWORD}
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql

volumes:
  mysql_data: 